{% load static %}
<head>
<meta name="viewport" content="width=device-width, initial-scale=0.8" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link href='http://fonts.googleapis.com/css?family=Allan:bold' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Cardo' rel='stylesheet' type='text/css'>
<link href="https://fonts.googleapis.com/css?family=Lato:700" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="{% static 'shoppingCart/stylesheet/style.css' %}" />
</head>
<body>
<div class="popup" data-popup2="popup-2" style ="z-index: 10">
    <div class="popup-inner">
      <div class = "listAdressEditOptions">
      	<div class="editCartWrapper">
      		<div class="cartSection">
      			<div class="col-xs-12 setMargin">
      				<div class="orderHeader">
      				<h3 class="menuHeading">Your Setting</h3>
      				 </div>
      				 <div class="OrderTypeSection">
      				 	<div class="orderButtonGroup f-btn-group">
      				 		<a id="deliveryType" class="f-btn">Delivery</a>
      				 		<a id="deliveryType" class="f-btn">Pickup</a>
      				 	</div>
      				 </div>
      			</div>
      			<div class="col-xs-12 setMargin">
      				<h5>Your Delivery Address</h5>
      				<div class="f-input-group">
      					<input type="text" id ="autocomplete3" class="form-control" placeholder="&#xf002;  Where do you live?" style="font-family:Arial, FontAwesome" name="q">
      				</div>
      			</div>
      		</div>
      	</div>
      </div>
      <br>
      <br>
        <button  onclick = "handleSaveAddres()" class=" btn btn-primary" href="#">Save</button>
        <button data-popup2-close="popup-2" class=" btn btn-primary" href="#">Cancel</button>
        <a class="popup-close" data-popup2-close="popup-2" href="#">x</a>
    </div>
</div>
<div id ="cartContainer" class = "cartContainer col-sm-3 pull-right s-row {% if isMenuPage %}keepopen{% endif %}">
<div class="s-row cartPanel panelContainer newPanel">
	<div id ="cartPanelContainer"  class="cart-contents">
		{% if isMenuPage or productsChosen %}
		<header class="cartHeader">
		<div class="cartOrder-info">
			<div class="shortCartHeader cart-borderbottom">
				<div class="cart-title">
					<h6>Your Order</h6>
				</div>
			</div>
			<div class="s-row shortCartAddress cart-borderbottom">
				<div class="cart-address">
				<div class="s-row"><span>Order Type: {{order_type}}</span></div>
				<div class ="s-row">From: {{restaurantName}}</div>
				<span>To: {{dest_address}}</span>
				</div>
				<div class="addressModificationLink">
					<a class="changeLabel" data-popup2-open="popup-2">Change</a>
				</div>
			</div>

		</div>
		</header>
		{%endif%}
		<div class="menucart-content">
		<div id= "cartPanel" class="cartPanelBody">
		{%if productsChosen%}
			<div id = "menuOrderCart" class="productsContainer"> 
				{% for product,sectionName, itemName in productsChosen %}
					<div id ="{{product.name}}container" class="chosenProd cart-borderbottom">
						<div class="prodQty text-center">
							{{product.qty}}
						</div>
						<div class="chosenprodContainer">
							<div class="prodName">
								<span>{{product.name}}  <i class="fa fa-pencil-square-o" aria-hidden="true"></i></span>
							</div>
							<ul class="prodDetails">
								{% for desc in product.customizationList  %}
									<li class= "desciptionList">
										<span>{{desc.name}}</span>
										{%if desc.price != 0%}
										<span> - ${{desc.price}}</span>
										{% endif %}
									</li>
								{% endfor %}
							</ul>
						</div>
						<div class="product-price text-center">
								${{product.price}}
						</div>
						<div class="prod-remove">
							<a class="btn" style ="font-size:150%" id ="{{product.name}}delete_{{sectionName}}_{{itemName}}" onclick="handleRemoveProduct(this)">
								<i class="fa fa-trash-o" aria-hidden="true"></i>
							</a>
						</div>
					</div>
				{% endfor %}
			</div>
			<div id ="subTotalWrapper" class="subTotalContainer">
				<div class="s-row chosenItem subtotalDescription">
				<div class="chosenItemLabel">
					<span>Items Subtotal:</span>
				</div>
				<div id ='ProductSubTotal' class="chosenItemValue text-right">
				$ {{subTotal}}
				</div>
				</div>

				<div class="s-row chosenItem subtotalDescription">
				<div class="chosenItemLabel">
					<span>Delivery Fee:</span>
				</div>
				<div id ='ProductDeliveryFee' class="chosenItemValue text-right">
				$ {{deliveryPrice}}
				</div>
				</div>

				<div class="s-row chosenItem subtotalDescription">
				<div class="chosenItemLabel">
					<span>Sales Tax:</span>
				</div>
				<div id ='ProductSalesTax' class="chosenItemValue text-right">
				$ {{salesTax}}
				</div>
				</div>

				<div class="s-row chosenItem subtotalDescription">
				<div class="chosenItemLabel">
					<span>Total:</span>
				</div>
				<div id ='ProductTotal' class="chosenItemValue text-right">
				$ {{totalAmt}}
				</div>
				</div>
			</div>
		{%else%}
			<div id ="cartEmptyContainer" class="cartEmpty text-center">
				<div class="cart-empty cart-borderbottom">
				<h5 class="emptyCart-text">Your Cart is Empty</h5>
				</div>
				{% if isMenuPage %}
				<div class="restaurantfees">
					<div class="minDeliveryCost cart-borderbottom">
						<span> Delivey Cost </span>
						{% if deliveryPrice == 0.0 %}
							<span class="costValue">Free</span>
						{% else %}
							<span class="costValue">${{deliveryPrice}}</span>
						{% endif %}
					</div>
					<div class="minDeliveryCost cart-borderbottom">
						<span> Minimum Order</span>
						<span class="costValue">${{restaurant.deliveryMin}}</span>
					</div>
				</div>
				{%endif%}
			</div>
		{%endif%}
		</div>
		</div>
		{%if productsChosen%}
		<div id ="cartFooterContainer" class="cartFooter">
			<div class="proceedButtonContainer">
			<div class="proceedButtonWrapper">
				<button class="btn proceedButton f-btn f-btn-full btn-info">
					<span> Proceed To Checkout</span>
					<span id ="totalValue">$ {{totalAmt}}</span>
				</button>
			</div>
			</div>
		</div>
		{%endif%}
	</div>
</div>
</div>
</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="http://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>
$(function(){
	$('[data-popup2-open]').on('click', function(e)  {
        var targeted_popup_class = jQuery(this).attr('data-popup2-open');
        $('[data-popup2="' + targeted_popup_class + '"]').fadeIn(350);
 
        e.preventDefault();
    });
    $('[data-popup2-close]').on('click', function(e)  {
        var targeted_popup_class = jQuery(this).attr('data-popup2-close');
        $('[data-popup2="' + targeted_popup_class + '"]').fadeOut(350);
 
        e.preventDefault();
    });
})
var restaurantName = "";
var delMin ="";
var delPrice ="";
function handleRemoveProduct(el){
	var id = el.id;
	var prodName= id.substring(0,id.indexOf("delete"));
	var section_itemName = id.substring(id.indexOf("delete")+"delete".length+1);
	console.log("prodName here:",prodName);
	var sectionName =  section_itemName.substring(0,section_itemName.lastIndexOf("_"));
	var itemName = section_itemName.substring(section_itemName.lastIndexOf("_")+1, section_itemName.length);

	console.log("sectionName here:",sectionName);

	console.log("itemName here:",itemName);

	var prodContainer = document.getElementById(prodName+"container");
	$.ajax({
                 type:"POST",
                 url:'{% url "shoppingCart:removeFromCart" %}',
                 data: {
                 		productName:prodName,
                 		sectionName: sectionName,
                 		itemName:itemName
                        },
                 success: function(result){
                 	console.log("result",result);
                 	restaurantName = result.restautantName;
                 	delMin = result.deliveryMin;
                 	delPrice = result.deliveryPrice;
                 	document.getElementById("menuOrderCart").removeChild(prodContainer);

					if(document.getElementById("menuOrderCart").innerHTML.trim()==""){
						if(document.getElementById("cartEmptyContainer")){
							document.getElementById("cartEmptyContainer").style.display ="block";
						}else{
							constructEmptyCartContainer(result.isMenuPage,delPrice,delMin)
						}
						
						document.getElementById("cartPanel").removeChild(document.getElementById("menuOrderCart"));
					}

					if(document.getElementById("subTotalWrapper")){
						if(result.subTotal !=0){
							document.getElementById("ProductSubTotal").textContent = "$" + result.subTotal;
							document.getElementById("ProductTotal").textContent = "$" + result.totalAmt;
						}else{
							document.getElementById("cartPanel").removeChild(document.getElementById("subTotalWrapper"));
							document.getElementById("cartPanelContainer").removeChild(document.getElementById("cartFooterContainer"));
						}
					}
                 }
    });
}

function constructProductContainer(productDetails,sectionName,itemName){

	var prodMenuContainer = document.getElementById("menuOrderCart");
	if(!prodMenuContainer){
		prodMenuContainer =  document.createElement("div");
		prodMenuContainer.className = "productsContainer";
		prodMenuContainer.id = "menuOrderCart";
		document.getElementById("cartPanel").appendChild(prodMenuContainer);
	}
	var productContainer = document.createElement("div");
	productContainer.className = "chosenProd cart-borderbottom";
	productContainer.id = productDetails.name +"container";
	prodMenuContainer.appendChild(productContainer);
	var prodQty = document.createElement("div");
	prodQty.className = "prodQty text-center";
	prodQty.textContent =productDetails.qty;
	productContainer.appendChild(prodQty);
	var productInnerContainer = document.createElement("div");
	productInnerContainer.className = "chosenprodContainer";
	productContainer.appendChild(productInnerContainer);
	var prodName = document.createElement("div");
	prodName.className ="prodName";
	productInnerContainer.appendChild(prodName);
	var nameSpan = document.createElement("span");
	nameSpan.textContent =  productDetails.name;
	prodName.appendChild(nameSpan);
	prodName.style.cursor="pointer";
	var itemEdit = document.createElement("i");
	itemEdit.className ="fa fa-pencil-square-o";
	itemEdit.setAttribute("aria-hidden","true");
	prodName.appendChild(itemEdit);
	var prodDescription = document.createElement("ul");
	productInnerContainer.appendChild(prodDescription);
	for(var i=0;i<productDetails.customizationList.length;i++){
		var productCustomization = document.createElement("li");
		productInnerContainer.appendChild(productCustomization);
		var customizationName = document.createElement("span");
		customizationName.textContent = productDetails.customizationList[i].name;
		productCustomization.appendChild(customizationName);
		if(productDetails.customizationList[i].price!=0){
			var customizationPrice = document.createElement("span");
			customizationPrice.textContent =" - $" + productDetails.customizationList[i].price;
			productCustomization.appendChild(customizationPrice);
		}
	}
	var prodPrice = document.createElement("div");
	prodPrice.className ="product-price text-center";
	prodPrice.textContent = "$"+productDetails.price;
	productContainer.appendChild(prodPrice);
	var prodRemove = document.createElement("div");
	prodRemove.className ="prod-remove";
	productContainer.appendChild(prodRemove);
	var prodRemoveButton = document.createElement("a");
	prodRemoveButton.id = productDetails.name+"delete_"+ sectionName +"_"+itemName;
	$(prodRemoveButton).bind( "click", function() {
		handleRemoveProduct(this);
	});
	prodRemove.appendChild(prodRemoveButton);
	prodRemoveButton.style.fontSize ="150%";
	var removeIcon = document.createElement("i");
	removeIcon.className = "fa fa-trash-o";
	removeIcon.setAttribute("aria-hidden","true");
	prodRemoveButton.appendChild(removeIcon);
}

function constructEmptyCartContainer(isMenuPage,delPrice,delMin){
	var cartContainer = document.createElement("div");
	cartContainer.id = "cartEmptyContainer";
	cartContainer.className = "cartEmpty text-center";
	document.getElementById("cartPanel").appendChild(cartContainer);
	var emptyCartHeder =document.createElement("div");
	emptyCartHeder.id="cart-empty cart-borderbottom";
	cartContainer.appendChild(emptyCartHeder); 
	var emptyCartHeaderText = document.createElement("h5");
	emptyCartHeaderText.className = "emptyCart-text";
	emptyCartHeaderText.textContent = "Your Cart is Empty";
	cartContainer.appendChild(emptyCartHeaderText);
	if(isMenuPage){
		var restaurantFeeInfo = document.createElement("div");
		restaurantFeeInfo.className = "restaurantfees";
		cartContainer.appendChild(restaurantFeeInfo);
		var restaurantDeliveryCostContainer = document.createElement("div");
		restaurantDeliveryCostContainer.className = "minDeliveryCost cart-borderbottom";
		restaurantFeeInfo.appendChild(restaurantDeliveryCostContainer);
		var deliveryCostHeader = document.createElement("span");
		deliveryCostHeader.textContent = "Delivey Cost";
		restaurantDeliveryCostContainer.appendChild(deliveryCostHeader);
		var deliveryCostValue = document.createElement("span");
		deliveryCostValue.className ="costValue";

		if(delPrice ==0.0){
			deliveryCostValue.textContent ="Free";
		}else{
			deliveryCostValue.textContent = delPrice;
		}
		restaurantDeliveryCostContainer.appendChild(deliveryCostValue);

		var restaurantDeliveryMinContainer = document.createElement("div");
		restaurantDeliveryMinContainer.className = "minDeliveryCost cart-borderbottom";
		restaurantFeeInfo.appendChild(restaurantDeliveryMinContainer);
		var deliveryCostHeader = document.createElement("span");
		deliveryCostHeader.textContent = "Minimum Order";
		restaurantDeliveryMinContainer.appendChild(deliveryCostHeader);
		var deliveryMinValue = document.createElement("span");
		deliveryMinValue.className ="costValue";
		deliveryMinValue.textContent ="$"+delMin;
		restaurantDeliveryMinContainer.appendChild(deliveryMinValue);
	}

}

function createSubTotalWrapper(subTotal,deliveryFee,taxAmt,total){
	var subTotalWrapper = document.createElement('div');
	subTotalWrapper.id ="subTotalWrapper";
	subTotalWrapper.className ="subTotalContainer";
	document.getElementById("cartPanel").appendChild(subTotalWrapper);
	constructSubTotalRow(subTotalWrapper,"","Items Subtotal:",subTotal);
	constructSubTotalRow(subTotalWrapper,"","Delivery Fee:",deliveryFee);
	constructSubTotalRow(subTotalWrapper,"","Sales Tax:",taxAmt);
	constructSubTotalRow(subTotalWrapper,"","Total:",total);
}

function constructSubTotalRow(subTotalWrapper,divId,labelName,value){
	var itemDescription = document.createElement("div");
		itemDescription.className ="s-row chosenItem subtotalDescription";
		subTotalWrapper.appendChild(itemDescription);
	var itemLabel = document.createElement("div");
		itemLabel.className ="chosenItemLabel";
		itemDescription.appendChild(itemLabel);
	var lableSpan = document.createElement("span");	
		lableSpan.textContent = labelName;
		itemLabel.appendChild(lableSpan);
	var itemValueWrapper = 	document.createElement("div");
		itemValueWrapper.id =divId;
		itemValueWrapper.className ="chosenItemValue text-right";
		itemValueWrapper.textContent = value;
	itemDescription.appendChild(itemValueWrapper);

}

function createCartFooter(totalValue){
	var cartFooter = document.createElement("div");
		cartFooter.className ="cartFooter";
		cartFooter.id ="cartFooterContainer";
	document.getElementById("cartPanelContainer").appendChild(cartFooter);
	var proceedButtonContainer = document.createElement("div");
	proceedButtonContainer.className = "proceedButtonContainer";
	cartFooter.appendChild(proceedButtonContainer);
	var proceedButtonWrapper = document.createElement("div");
	proceedButtonWrapper.className = "proceedButtonWrapper";
	proceedButtonContainer.appendChild(proceedButtonWrapper);
	var proceedButton = document.createElement("button");
	proceedButton.className = "btn proceedButton f-btn f-btn-full btn-info";
	proceedButtonWrapper.appendChild(proceedButton);
	var proceedButtonLabel = document.createElement("span");
	proceedButtonLabel.textContent ="Proceed To Checkout";
	proceedButton.appendChild(proceedButtonLabel);
	var proceedButtonValue = document.createElement("span");
	proceedButtonValue.id = "totalValue";
	proceedButtonValue.textContent ="$ "+ totalValue;
	proceedButton.appendChild(proceedButtonValue);
}
function handleSaveAddres(){

}
function handleCartClick(){
	console.log("in handleCartClick");
	$( "#cartContainer" ).toggle("slide",{ direction: "right" });
}
</script>
